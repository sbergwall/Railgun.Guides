# Local Administrator Password Solution (LAPS)

> **Version Information**:  
> - Documentation based on Windows LAPS (May 2024)
> - For use with Windows Server 2019/2022 and Windows 10/11
> - Last Updated: May 24, 2025

This guide explains how to deploy and configure Microsoft's Local Administrator Password Solution (LAPS) to automatically manage local administrator account passwords across your domain.

## Overview

LAPS provides two key capabilities:
1. Automatic local administrator password management
2. Secure storage of passwords in Active Directory
3. Role-based access control for password retrieval

> **Important Security Notes**: 
> - LAPS should NOT be deployed on Tier 0 assets (Domain Controllers, PKI servers, etc.). These critical security infrastructure components should use separate, more tightly controlled password management procedures.
> - Access to LAPS passwords must follow the tiered administration model:
>   - Tier 0 administrators should not use LAPS-managed accounts
>   - Tier 1 administrators should only have access to Tier 1 LAPS passwords
>   - Tier 2 administrators can have access to Tier 2 and workstation LAPS passwords
> - Administrative workstations used to access LAPS must be at the same or higher tier than the systems being managed

## Prerequisites

- Active Directory domain with:
  - Domain functional level: 2016
  - Schema admin rights for initial setup
- Target computers:
  - Windows 10/11 or Windows Server 2019
  - Domain joined
  - Network connectivity to domain controllers

## 1. Prepare Active Directory

### 1.1 Create Security Groups

```powershell
# Create OU for LAPS groups if it doesn't exist
$Path = "OU=Groups,OU=company,DC=company,DC=pri"
New-ADOrganizationalUnit -Name "Groups" -Path "OU=company,DC=company,DC=pri" -Description "All group containers for company domain"
New-ADOrganizationalUnit -Name "LAPS" -Path $Path -Description "Security Groups for LAPS"

# Create groups for Tier 1 server password access
$Tier1GroupProps = @{
    Name = 'LAPS-Tier1-RO'
    SamAccountName = 'LAPS-Tier1-RO'
    Description = 'Members allowed to read LAPS passwords for Tier 1 Servers'
    DisplayName = 'LAPS-Tier1-RO'
    GroupCategory = 'Security'
    GroupScope = 'Universal'
    Path = 'OU=LAPS,OU=Groups,OU=company,DC=company,DC=pri'
}
New-ADGroup @Tier1GroupProps

# Create groups for Tier 2 server password access
$Tier2GroupProps = @{
    Name = 'LAPS-Tier2-RO'
    SamAccountName = 'LAPS-Tier2-RO'
    Description = 'Members allowed to read LAPS passwords for Tier 2 Servers'
    DisplayName = 'LAPS-Tier2-RO'
    GroupCategory = 'Security'
    GroupScope = 'Universal'
    Path = 'OU=LAPS,OU=Groups,OU=company,DC=company,DC=pri'
}
New-ADGroup @Tier2GroupProps

# Create groups for workstation password access (Tier 2)
$WorkstationGroupProps = @{
    Name = 'LAPS-Workstation-RO'
    SamAccountName = 'LAPS-Workstation-RO'
    Description = 'Members allowed to read LAPS passwords for Workstations (Tier 2)'
    DisplayName = 'LAPS-Workstation-RO'
    GroupCategory = 'Security'
    GroupScope = 'Universal'
    Path = 'OU=LAPS,OU=Groups,OU=company,DC=company,DC=pri'
}
New-ADGroup @WorkstationGroupProps
```

### 1.2 Extend Active Directory Schema

```powershell
# Import Windows LAPS PowerShell module
Import-Module LAPS

# Update AD Schema for Windows LAPS
Update-LapsADSchema
```

### 1.3 Configure Permissions

```powershell
# Define OUs where LAPS will be deployed
# Note: Tier 0 assets should NOT use LAPS for security reasons
$OUsServers = @(
    'OU=Tier 1,OU=Servers,OU=Computers,OU=company,DC=company,DC=pri',
    'OU=Tier 2,OU=Servers,OU=Computers,OU=company,DC=company,DC=pri'
)
$OUsWorkstations = @(
    'OU=Workstations,OU=Computers,,OU=company,DC=company,DC=pri'
)

# Configure permissions for Tier 1 servers
$Tier1OU = 'OU=Tier 1,OU=Servers,OU=Computers,OU=company,DC=company,DC=pri'
Set-LapsADComputerSelfPermission -Identity $Tier1OU
Set-LapsADReadPasswordPermission -Identity $Tier1OU -AllowedPrincipals "LAPS-Tier1-RO@company.pri"

# Configure permissions for Tier 2 servers
$Tier2OU = 'OU=Tier 2,OU=Servers,OU=Computers,OU=company,DC=company,DC=pri'
Set-LapsADComputerSelfPermission -Identity $Tier2OU
Set-LapsADReadPasswordPermission -Identity $Tier2OU -AllowedPrincipals "LAPS-Tier2-RO@company.pri"

# Configure permissions for workstations (Tier 2)
foreach ($OU in $OUsWorkstations) {
    Set-LapsADComputerSelfPermission -Identity $OU
    Set-LapsADReadPasswordPermission -Identity $OU -AllowedPrincipals "LAPS-Workstation-RO@company.pri"
}
```

## 2. Install LAPS Components

### 2.2 Configure Group Policy

1. Create a new GPO for LAPS configuration
2. Edit the GPO and configure these settings:

**Computer Configuration > Policies > Administrative Templates > System > LAPS**
- **Configure password backup** directory set to **Active Directory**
- **Password Settings** and **Enable** the setting. Optionally change the configuration.
- **Configure size of encrypted password history** set to 6 or larger.
- **Enable password encryption** set to Enable
- 

### 3.2 Link GPO
Link the LAPS GPO to the appropriate OUs containing computers that should have LAPS enabled.

## 4. Verification

### 4.1 Check Schema Extension
```powershell
Get-LapsADSchema
```

### 4.2 Test Password Retrieval
```powershell
# Get password for a specific computer
Get-LapsADPassword -Identity "WEC1" -AsPlainText
```

## 5. Maintenance Tasks

1. **Regular Auditing**
   - Review members of LAPS groups
   - Check password retrieval logs
   - Verify GPO application

2. **Password Access**
   - Use AD or PowerShell to retrieve passwords
   - Document password retrieval process

3. **Troubleshooting**
   - Verify GPO application (gpresult /h report.html)
- **Event Viewer:** LAPS logs are found at `Applications and Services > Microsoft > Windows > LAPS`.
- **Diagnostics:**
  ```powershell
  Get-LapsDiagnostics
  ```
- **Verify permissions:**
  ```powershell
  Find-LapsADExetendedRights -Identity "OU=Workstations,OU=Computers,DC=company,DC=pri"
  ```

## Security Considerations

1. **Access Control**
   - Strictly limit membership in LAPS reader groups
   - Audit password retrievals
   - Use separate groups for servers and workstations

2. **Emergency Access**
   - Document recovery procedures
   - Maintain backup access methods
   - Test recovery processes regularly

3. **Tiered Access Control**
   - Strictly enforce tiered administration model
   - Tier 1 admins must only access Tier 1 LAPS passwords using Tier 1 PAWs
   - Tier 2 admins must only access Tier 2 and workstation LAPS passwords using Tier 2 PAWs
   - Never mix tiers - maintain strict separation
   - Audit password retrievals by tier

## References

- [Microsoft LAPS Documentation](https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-overview)
- [LAPS Security Considerations](https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-security-considerations)
- [LAPS Technical Reference](https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-technical-reference)
[lazyadmin.nl - How to Deploy Windows LAPS](https://lazyadmin.nl/it/windows-laps/)