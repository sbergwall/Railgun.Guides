# Local Administrator Password Solution (LAPS)

> **Version Information**:  
> - Documentation based on Windows LAPS (May 2024)
> - For use with Windows Server 2019/2022 and Windows 10/11
> - Last Updated: May 24, 2025

This guide explains how to deploy and configure Microsoft's Local Administrator Password Solution (LAPS) to automatically manage local administrator account passwords across your domain.

## Overview

LAPS provides two key capabilities:
1. Automatic local administrator password management
2. Secure storage of passwords in Active Directory
3. Role-based access control for password retrieval

> **Important Security Notes**: 
> - LAPS should NOT be deployed on Tier 0 assets (Domain Controllers, PKI servers, etc.). These critical security infrastructure components should use separate, more tightly controlled password management procedures.
> - Access to LAPS passwords must follow the tiered administration model:
>   - Tier 0 administrators should not use LAPS-managed accounts
>   - Tier 1 administrators should only have access to Tier 1 LAPS passwords
>   - Tier 2 administrators can have access to Tier 2 and workstation LAPS passwords
> - Administrative workstations used to access LAPS must be at the same or higher tier than the systems being managed

## Prerequisites

- Active Directory domain with:
  - Domain functional level: Windows Server 2008 R2 or later
  - Schema admin rights for initial setup
  - Domain admin rights for configuration
- Target computers:
  - Windows 10/11 or Windows Server 2016 or later
  - Domain joined
  - Network connectivity to domain controllers

## 1. Prepare Active Directory

### 1.1 Create Security Groups

```powershell
# Create OU for LAPS groups if it doesn't exist
$Path = "OU=SecurityGroups,OU=Groups,DC=domain,DC=com"
New-ADOrganizationalUnit -Name "LAPS" -Path $Path -Description "Security Groups for LAPS"

# Create groups for Tier 1 server password access
$Tier1GroupProps = @{
    Name = 'LAPS-Tier1-RO'
    SamAccountName = 'LAPS-Tier1-RO'
    Description = 'Members allowed to read LAPS passwords for Tier 1 Servers'
    DisplayName = 'LAPS-Tier1-RO'
    GroupCategory = 'Security'
    GroupScope = 'Universal'
    Path = 'OU=LAPS,OU=SecurityGroups,OU=Groups,DC=domain,DC=com'
}
New-ADGroup @Tier1GroupProps

# Create groups for Tier 2 server password access
$Tier2GroupProps = @{
    Name = 'LAPS-Tier2-RO'
    SamAccountName = 'LAPS-Tier2-RO'
    Description = 'Members allowed to read LAPS passwords for Tier 2 Servers'
    DisplayName = 'LAPS-Tier2-RO'
    GroupCategory = 'Security'
    GroupScope = 'Universal'
    Path = 'OU=LAPS,OU=SecurityGroups,OU=Groups,DC=domain,DC=com'
}
New-ADGroup @Tier2GroupProps

# Create groups for workstation password access (Tier 2)
$WorkstationGroupProps = @{
    Name = 'LAPS-Workstation-RO'
    SamAccountName = 'LAPS-Workstation-RO'
    Description = 'Members allowed to read LAPS passwords for Workstations (Tier 2)'
    DisplayName = 'LAPS-Workstation-RO'
    GroupCategory = 'Security'
    GroupScope = 'Universal'
    Path = 'OU=LAPS,OU=SecurityGroups,OU=Groups,DC=domain,DC=com'
}
New-ADGroup @WorkstationGroupProps
```

### 1.2 Extend Active Directory Schema

```powershell
# Import LAPS PowerShell module
Import-Module AdmPwd.PS

# Update AD Schema
Update-AdmPwdADSchema
```

### 1.3 Configure Permissions

```powershell
# Define OUs where LAPS will be deployed
# Note: Tier 0 assets should NOT use LAPS for security reasons
$OUsServers = @(
    'OU=Tier 1,OU=Servers,OU=Computers,DC=domain,DC=com',
    'OU=Tier 2,OU=Servers,OU=Computers,DC=domain,DC=com'
)
$OUsWorkstations = @(
    'OU=Workstations,OU=Computers,DC=domain,DC=com'
)

# Configure permissions for Tier 1 servers
$Tier1OU = 'OU=Tier 1,OU=Servers,OU=Computers,DC=domain,DC=com'
Set-AdmPwdComputerSelfPermission -OrgUnit $Tier1OU
Set-AdmPwdReadPasswordPermission -Identity $Tier1OU -AllowedPrincipals "LAPS-Tier1-RO"

# Configure permissions for Tier 2 servers
$Tier2OU = 'OU=Tier 2,OU=Servers,OU=Computers,DC=domain,DC=com'
Set-AdmPwdComputerSelfPermission -OrgUnit $Tier2OU
Set-AdmPwdReadPasswordPermission -Identity $Tier2OU -AllowedPrincipals "LAPS-Tier2-RO"

# Configure permissions for workstations (Tier 2)
foreach ($OU in $OUsWorkstations) {
    Set-AdmPwdComputerSelfPermission -OrgUnit $OU
    Set-AdmPwdReadPasswordPermission -Identity $OU -AllowedPrincipals "LAPS-Workstation-RO"
}
```

## 2. Install LAPS Components

### 2.1 Management Tools Installation

Install the LAPS UI and PowerShell tools on administrative workstations:

```powershell
# Create temporary directory
$Date = Get-Date -Format yyyyMMdd_hhmm
$TempFolder = "C:\Temp_$Date"
New-Item -Path $TempFolder -ItemType Directory -Force

# Download LAPS installers
$URLs = @(
    'https://download.microsoft.com/download/C/7/A/C7AAD914-A8A6-4904-88A1-29E657445D03/LAPS.x64.msi',
    'https://download.microsoft.com/download/C/7/A/C7AAD914-A8A6-4904-88A1-29E657445D03/LAPS.x86.msi'
)

foreach ($URL in $URLs) {
    $fileName = Split-Path $URL -Leaf
    $DestinationPath = Join-Path $TempFolder -ChildPath $fileName
    Invoke-WebRequest -Uri $URL -OutFile $DestinationPath
}

# Install LAPS management tools
Start-Process msiexec -ArgumentList "/i $TempFolder\LAPS.x64.msi ADDLOCAL=Management.UI,Management.PS,Management.ADMX /quiet /norestart" -Wait -NoNewWindow
```

### 2.2 Configure Group Policy

1. Create a new GPO for LAPS configuration
2. Edit the GPO and configure these settings:

**Computer Configuration > Policies > Administrative Templates > LAPS**
- Enable local admin password management: **Enabled**
- Password Settings:
  - Complexity: **Large letters + small letters + numbers + special characters**
  - Length: **20** characters (recommended)
  - Password Age: **30** days (adjustable)
- Do not allow password expiration time longer than required by policy: **Enabled**
- Enable local admin password management: **Enabled**

**Computer Configuration > Policies > Security Settings > Software Settings**
- Add new package: `\\domain\NETLOGON\LAPS\LAPS.x64.msi`
- Deployment Method: **Advanced**
- Modifications tab: **Required and disabled**

## 3. Deploy LAPS Client

### 3.1 Prepare Distribution Share

```powershell
# Create LAPS share
$SharePath = "\\dc01\NETLOGON\LAPS"
New-Item -Path $SharePath -ItemType Directory -Force

# Copy LAPS installer
Copy-Item -Path "$TempFolder\LAPS.x64.msi" -Destination $SharePath
```

### 3.2 Link GPO
Link the LAPS GPO to the appropriate OUs containing computers that should have LAPS enabled.

## 4. Verification

### 4.1 Check Schema Extension
```powershell
Get-AdmPwdADSchema
```

### 4.2 Test Password Retrieval
```powershell
# Get password for a specific computer
Get-AdmPwdPassword -ComputerName "WIN-CLIENT01"
```

### 4.3 Verify Client Installation
```powershell
# Check if LAPS is installed and configured on a client
Get-ItemProperty -Path "HKLM:\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\GPExtensions" -Name "AdmPwd" -ErrorAction SilentlyContinue
```

## 5. Maintenance Tasks

1. **Regular Auditing**
   - Review members of LAPS groups
   - Check password retrieval logs
   - Verify GPO application

2. **Password Access**
   - Use LAPS UI or PowerShell to retrieve passwords
   - Document password retrieval process
   - Train help desk staff

3. **Troubleshooting**
   - Check event logs (Microsoft-Windows-LAPS/Operational)
   - Verify GPO application (gpresult /h report.html)
   - Test network connectivity

## Security Considerations

1. **Access Control**
   - Strictly limit membership in LAPS reader groups
   - Audit password retrievals
   - Use separate groups for servers and workstations

2. **Network Security**
   - Ensure secure communication between clients and DCs
   - Protect LAPS installation files
   - Monitor for unauthorized access attempts

3. **Emergency Access**
   - Document recovery procedures
   - Maintain backup access methods
   - Test recovery processes regularly

4. **Tiered Access Control**
   - Strictly enforce tiered administration model
   - Tier 1 admins must only access Tier 1 LAPS passwords using Tier 1 PAWs
   - Tier 2 admins must only access Tier 2 and workstation LAPS passwords using Tier 2 PAWs
   - Never mix tiers - maintain strict separation
   - Audit password retrievals by tier

## References

- [Microsoft LAPS Documentation](https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-overview)
- [LAPS Security Considerations](https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-security-considerations)
- [LAPS Technical Reference](https://learn.microsoft.com/en-us/windows-server/identity/laps/laps-technical-reference)
